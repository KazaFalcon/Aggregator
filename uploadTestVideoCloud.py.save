import os
import json
import time
import shutil
from azure.storage.blob import BlobService
import requests
import subprocess
blobService = BlobService(account_name='changovideoanalytics', account_key='tI80QuwOnv282ttR9HmXLqJR0WosC6vC1rH5H2sBdbxsVjkARCHFGjpEmbnM5+AUbKGmy7t03VgP+JCyUl64CQ==')
directory="/home/UploadedVideos/"
containerName="avi"

nt (response)
  #  print "In save to database"
  # except :
    #    print "exception"
       # pass

  
for filename in os.listdir(directory):
	if filename.endswith(".avi"): 
        	#print(os.path.join(directory, filename))
        	path=os.path.join(directory, filename)
		print(path)
		AggregatorId,CameraId,file=filename.split("_")
	try:
		blobService.put_block_blob_from_path(containerName,filename,path)
		url = blobService.make_blob_url(container_name=containerName,blob_name=filename)
		url = '{0}://{1}{2}/{3}/{4}'.format("https","changovideoanalytics",".blob.core.windows.net",containerName,filename)
	#	SaveToDatabase(AggregatorId,CameraId,url)
		print (url)
		time.sleep(8)
		os.remove(path)
		
		
	except Exception as e: 
		print(e)
		pass
		continue
	


